<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ë³´í—˜ ìƒí’ˆ ë¹„êµ ë„ìš°ë¯¸ - UI Prototype</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Oxygen', 'Ubuntu', 'Cantarell', sans-serif;
            background-color: #f5f5f5;
            color: #333;
            line-height: 1.6;
        }

        .container {
            max-width: 900px;
            margin: 0 auto;
            background-color: white;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }

        .header {
            background-color: #fff;
            border-bottom: 1px solid #e0e0e0;
            padding: 20px;
            text-align: center;
        }

        .header h1 {
            font-size: 24px;
            margin-bottom: 8px;
        }

        .chat-stream {
            flex: 1;
            padding: 20px;
            overflow-y: auto;
        }

        .intro-section {
            background-color: #f9f9f9;
            border: 1px solid #e0e0e0;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
        }

        .intro-section h2 {
            font-size: 18px;
            margin-bottom: 12px;
        }

        .intro-section p {
            margin-bottom: 12px;
            color: #666;
        }

        .collapsible {
            background-color: #fff;
            border: 1px solid #ddd;
            border-radius: 4px;
            padding: 12px;
            margin-top: 12px;
        }

        .collapsible summary {
            cursor: pointer;
            font-weight: 600;
            margin-bottom: 8px;
        }

        .collapsible[open] summary {
            margin-bottom: 12px;
        }

        .collapsible ul {
            list-style-position: inside;
            color: #555;
        }

        .collapsible ul li {
            margin-bottom: 8px;
        }

        .example-questions {
            background-color: #fff;
            border: 1px solid #e0e0e0;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
        }

        .example-questions h3 {
            font-size: 16px;
            margin-bottom: 16px;
        }

        .example-btn {
            display: block;
            width: 100%;
            padding: 12px 16px;
            margin-bottom: 10px;
            background-color: #f0f0f0;
            border: 1px solid #ddd;
            border-radius: 6px;
            cursor: pointer;
            text-align: left;
            font-size: 14px;
            transition: background-color 0.2s;
        }

        .example-btn:hover {
            background-color: #e8e8e8;
        }

        .example-btn.active {
            background-color: #e0f2ff;
            border-color: #0066cc;
        }

        .message-bubble {
            margin-bottom: 20px;
        }

        .user-message {
            background-color: #e8f5e9;
            border-radius: 12px;
            padding: 12px 16px;
            margin-bottom: 16px;
            max-width: 80%;
        }

        .system-response {
            background-color: #fff;
            border: 1px solid #e0e0e0;
            border-radius: 12px;
            padding: 20px;
        }

        .premium-notice {
            background-color: #fff3cd;
            border: 1px solid #ffc107;
            border-radius: 6px;
            padding: 16px;
            margin-bottom: 20px;
        }

        .premium-notice h4 {
            color: #856404;
            margin-bottom: 8px;
            font-size: 16px;
        }

        .premium-notice p {
            color: #856404;
            font-size: 14px;
            line-height: 1.5;
        }

        .section {
            margin-bottom: 24px;
        }

        .section h3 {
            font-size: 18px;
            margin-bottom: 12px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .query-summary ul {
            list-style: none;
            padding-left: 0;
        }

        .query-summary li {
            padding: 6px 0;
        }

        .comparison-table {
            width: 100%;
            border-collapse: collapse;
            overflow-x: auto;
            display: block;
            margin-bottom: 16px;
        }

        .comparison-table table {
            width: 100%;
            min-width: 600px;
        }

        .comparison-table th,
        .comparison-table td {
            border: 1px solid #ddd;
            padding: 12px;
            text-align: left;
        }

        .comparison-table th {
            background-color: #f5f5f5;
            font-weight: 600;
        }

        .comparison-table .company-header {
            background-color: #f0f0f0;
            font-weight: 700;
        }

        .evidence {
            font-size: 12px;
            color: #666;
            margin-top: 4px;
            cursor: pointer;
        }

        .evidence:hover {
            color: #0066cc;
            text-decoration: underline;
        }

        .value-check {
            color: #4caf50;
            font-size: 18px;
        }

        .value-cross {
            color: #f44336;
            font-size: 18px;
        }

        .value-unavailable {
            color: #999;
        }

        .notes-section {
            background-color: #f9f9f9;
            border-radius: 6px;
            padding: 16px;
        }

        .notes-summary {
            margin-bottom: 12px;
        }

        .notes-details {
            background-color: #fff;
            border: 1px solid #e0e0e0;
            border-radius: 4px;
            padding: 12px;
        }

        .notes-details summary {
            cursor: pointer;
            font-weight: 600;
            padding: 8px;
        }

        .notes-details ul {
            list-style-position: inside;
            margin-top: 12px;
            padding-left: 8px;
        }

        .notes-details li {
            margin-bottom: 8px;
            line-height: 1.5;
        }

        .limitations-section {
            background-color: #fff3cd;
            border: 1px solid #ffc107;
            border-radius: 6px;
            padding: 16px;
        }

        .limitations-section summary {
            cursor: pointer;
            font-weight: 600;
            padding: 8px;
            color: #856404;
        }

        .limitations-section ul {
            list-style-position: inside;
            margin-top: 12px;
            padding-left: 8px;
        }

        .limitations-section li {
            margin-bottom: 8px;
            color: #856404;
            line-height: 1.5;
        }

        .footer-timestamp {
            font-size: 12px;
            color: #999;
            margin-top: 16px;
            text-align: right;
        }

        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
        }

        .modal.active {
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .modal-content {
            background-color: white;
            border-radius: 8px;
            padding: 24px;
            max-width: 600px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 16px;
        }

        .modal-header h4 {
            font-size: 18px;
        }

        .modal-close {
            background: none;
            border: none;
            font-size: 24px;
            cursor: pointer;
            padding: 0;
            width: 32px;
            height: 32px;
        }

        .evidence-detail {
            margin-bottom: 12px;
        }

        .evidence-detail label {
            font-weight: 600;
            display: block;
            margin-bottom: 4px;
            color: #555;
        }

        .evidence-detail .value {
            padding: 8px;
            background-color: #f9f9f9;
            border-radius: 4px;
        }

        .snippet {
            background-color: #f5f5f5;
            border-left: 3px solid #0066cc;
            padding: 12px;
            margin-top: 12px;
            font-family: monospace;
            font-size: 13px;
            white-space: pre-wrap;
        }

        .btn-primary {
            background-color: #0066cc;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            margin-top: 16px;
        }

        .btn-primary:hover {
            background-color: #0052a3;
        }

        @media (max-width: 768px) {
            .comparison-table {
                font-size: 14px;
            }

            .comparison-table th,
            .comparison-table td {
                padding: 8px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸ’¬ ë³´í—˜ ìƒí’ˆ ë¹„êµ ë„ìš°ë¯¸</h1>
            <p>Response View Model ë Œë”ë§ í”„ë¡œí† íƒ€ì…</p>
        </div>

        <div class="chat-stream" id="chatStream">
            <!-- Intro Section -->
            <div class="intro-section">
                <h2>ì‹œìŠ¤í…œ ì•ˆë‚´</h2>
                <p>ì €ëŠ” ë³´í—˜ ì•½ê´€ê³¼ ê°€ì…ì„¤ê³„ì„œë¥¼ ê¸°ë°˜ìœ¼ë¡œ ê°ê´€ì ì¸ ì •ë³´ë¥¼ ì œê³µí•©ë‹ˆë‹¤.</p>

                <details class="collapsible">
                    <summary>ìƒì„¸ ì•ˆë‚´ â–¼</summary>
                    <div>
                        <h4>âœ… ì œê°€ í•  ìˆ˜ ìˆëŠ” ê²ƒ</h4>
                        <ul>
                            <li>ì—¬ëŸ¬ ë³´í—˜ì‚¬ ìƒí’ˆì˜ ë³´ì¥ ë‚´ìš© ë¹„êµ</li>
                            <li>íŠ¹ì • ë‹´ë³´ ë³´ì¥ ì—¬ë¶€ í™•ì¸</li>
                            <li>ë¬¸ì„œ ê¸°ë°˜ ì‚¬ì‹¤ ì •ë³´ ì œê³µ (ì¶œì²˜ ëª…ì‹œ)</li>
                        </ul>

                        <h4 style="margin-top: 16px;">âŒ ì œê°€ í•  ìˆ˜ ì—†ëŠ” ê²ƒ</h4>
                        <ul>
                            <li>ê°œì¸ ë§ì¶¤ ìƒí’ˆ ì¶”ì²œ</li>
                            <li>ê°œì¸ë³„ ë³´í—˜ë£Œ ê³„ì‚°</li>
                            <li>ë¬¸ì„œì— ì—†ëŠ” ë‚´ìš© ì¶”ë¡ </li>
                        </ul>
                    </div>
                </details>
            </div>

            <!-- Example Questions -->
            <div class="example-questions">
                <h3>ğŸ“Œ ì˜ˆì œ ì„ íƒ</h3>
                <button class="example-btn" onclick="loadExample('example1_premium')">
                    ì˜ˆì œ 1: ë³´í—˜ë£Œ ë¹„êµ (ë³´í—˜ë£Œ ê²½ê³ )
                </button>
                <button class="example-btn" onclick="loadExample('example2_coverage_compare')">
                    ì˜ˆì œ 2: ë‹´ë³´ ì¡°ê±´ ë¹„êµ (5ê°œ ì¡°ê±´)
                </button>
                <button class="example-btn" onclick="loadExample('example3_product_summary')">
                    ì˜ˆì œ 3: ìƒí’ˆ ì¢…í•© ë¹„êµ â­ (9ê°œ ë‹´ë³´)
                </button>
                <button class="example-btn" onclick="loadExample('example4_ox')">
                    ì˜ˆì œ 4: ë³´ì¥ ì—¬ë¶€ í™•ì¸ (O/X)
                </button>
            </div>

            <!-- Response Area -->
            <div id="responseArea"></div>
        </div>
    </div>

    <!-- Evidence Modal -->
    <div id="evidenceModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h4 id="modalTitle">Evidence ìƒì„¸</h4>
                <button class="modal-close" onclick="closeEvidenceModal()">Ã—</button>
            </div>
            <div id="modalBody"></div>
        </div>
    </div>

    <script>
        let currentData = null;

        async function loadExample(exampleName) {
            try {
                const response = await fetch(`./fixtures/${exampleName}.json`);
                const data = await response.json();
                currentData = data;
                renderResponse(data);

                // Highlight active button
                document.querySelectorAll('.example-btn').forEach(btn => btn.classList.remove('active'));
                event.target.classList.add('active');
            } catch (error) {
                console.error('Failed to load example:', error);
                alert('ì˜ˆì œ ë¡œë”© ì‹¤íŒ¨: ' + error.message);
            }
        }

        function renderResponse(data) {
            const responseArea = document.getElementById('responseArea');

            let html = '';

            // User Message
            html += `
                <div class="message-bubble">
                    <div class="user-message">
                        ${data.query_summary.original_query}
                    </div>
                </div>
            `;

            // System Response Card
            html += '<div class="system-response">';

            // Premium Notice (if applicable)
            if (data.meta.premium_notice) {
                html += `
                    <div class="premium-notice">
                        <h4>âš ï¸ ë³´í—˜ë£Œ ì•ˆë‚´</h4>
                        <p>ë³´í—˜ë£ŒëŠ” ê°œì¸ë³„ ì¡°ê±´ (ë‚˜ì´, ì„±ë³„, ê±´ê°•ìƒíƒœ ë“±)ì— ë”°ë¼ ë‹¬ë¼ì§‘ë‹ˆë‹¤.
                        ë³¸ ì‹œìŠ¤í…œì€ ê°œì¸ë³„ ë³´í—˜ë£Œ ê³„ì‚° ê¸°ëŠ¥ì„ ì œê³µí•˜ì§€ ì•Šìœ¼ë©°, ë¬¸ì„œìƒ ì˜ˆì‹œë§Œ í‘œì‹œí•©ë‹ˆë‹¤.</p>
                        <p style="margin-top: 8px;">ì •í™•í•œ ë³´í—˜ë£ŒëŠ” ë³´í—˜ì‚¬ ë˜ëŠ” ì„¤ê³„ì‚¬ë¥¼ í†µí•´ í™•ì¸í•˜ì‹œê¸° ë°”ëë‹ˆë‹¤.</p>
                    </div>
                `;
            }

            // Query Summary
            html += renderQuerySummary(data.query_summary);

            // Comparison
            html += renderComparison(data.comparison);

            // Notes
            html += renderNotes(data.notes);

            // Limitations
            html += renderLimitations(data.limitations);

            // Footer
            html += `
                <div class="footer-timestamp">
                    ìƒì„± ì‹œê°: ${new Date(data.meta.generated_at).toLocaleString('ko-KR')}
                </div>
            `;

            html += '</div>'; // End system-response

            responseArea.innerHTML = html;
        }

        function renderQuerySummary(querySummary) {
            let html = `
                <div class="section query-summary">
                    <h3>ğŸ“‹ ë¹„êµ ëŒ€ìƒ ìƒí’ˆ</h3>
                    <ul>
            `;

            querySummary.target_products.forEach(product => {
                html += `<li>â€¢ ${product.insurer} ${product.product_name}</li>`;
            });

            html += `
                    </ul>
                </div>
            `;

            return html;
        }

        function renderComparison(comparison) {
            let html = `
                <div class="section comparison">
                    <h3>ğŸ“Š ë³´ì¥ ë¹„êµí‘œ</h3>
                    <div class="comparison-table">
                        <table>
                            <thead>
                                <tr>
                                    <th>ë‹´ë³´</th>
            `;

            // Company headers
            comparison.products.forEach(product => {
                html += `
                    <th class="company-header">
                        ${product.insurer}<br>
                        <span style="font-weight: 400; font-size: 13px;">${product.product_name}</span>
                    </th>
                `;
            });

            html += `
                                </tr>
                            </thead>
                            <tbody>
            `;

            // Rows for each dimension
            comparison.dimensions.forEach(dimension => {
                html += `<tr>`;
                html += `<td><strong>${dimension.label}</strong></td>`;

                comparison.products.forEach(product => {
                    const row = product.rows[dimension.key];
                    html += `<td>`;

                    if (row) {
                        // Render value based on type
                        if (dimension.type === 'boolean') {
                            if (row.value === true) {
                                html += '<span class="value-check">âœ“</span>';
                            } else if (row.value === false) {
                                html += '<span class="value-cross">âœ—</span>';
                            } else {
                                html += '<span class="value-unavailable">í™•ì¸ ë¶ˆê°€</span>';
                            }
                        } else if (row.value === 'í™•ì¸ ë¶ˆê°€' || row.value === null) {
                            html += '<span class="value-unavailable">í™•ì¸ ë¶ˆê°€</span>';
                        } else {
                            html += row.value;
                        }

                        // Evidence
                        if (row.evidence) {
                            const evidenceData = JSON.stringify({
                                label: dimension.label,
                                insurer: product.insurer,
                                value: row.value,
                                evidence: row.evidence
                            }).replace(/"/g, '&quot;');
                            html += `<div class="evidence" onclick='showEvidence(${evidenceData})'>ğŸ“„ ${row.evidence}</div>`;
                        } else {
                            html += '<div class="evidence value-unavailable">ğŸ“„ í™•ì¸ ë¶ˆê°€</div>';
                        }
                    } else {
                        html += '<span class="value-unavailable">í™•ì¸ ë¶ˆê°€</span>';
                        html += '<div class="evidence value-unavailable">ğŸ“„ í™•ì¸ ë¶ˆê°€</div>';
                    }

                    html += `</td>`;
                });

                html += `</tr>`;
            });

            html += `
                            </tbody>
                        </table>
                    </div>
                </div>
            `;

            return html;
        }

        function renderNotes(notes) {
            let html = `
                <div class="section notes-section">
                    <h3>ğŸ“ ìš”ì•½</h3>
                    <div class="notes-summary">
                        ${notes.summary}
                    </div>
            `;

            if (notes.details && notes.details.length > 0) {
                html += `
                    <details class="notes-details">
                        <summary>ìƒì„¸ ë‚´ìš© í¼ì¹˜ê¸° â–¼</summary>
                        <ul>
                `;

                notes.details.forEach(detail => {
                    html += `<li>${detail}</li>`;
                });

                html += `
                        </ul>
                    </details>
                `;
            }

            html += `</div>`;

            return html;
        }

        function renderLimitations(limitations) {
            let html = `
                <div class="section limitations-section">
                    <details>
                        <summary>âš ï¸ ì£¼ì˜ì‚¬í•­ í¼ì¹˜ê¸° â–¼</summary>
                        <ul>
            `;

            limitations.forEach(limitation => {
                html += `<li>${limitation}</li>`;
            });

            html += `
                        </ul>
                    </details>
                </div>
            `;

            return html;
        }

        function showEvidence(evidenceData) {
            const modal = document.getElementById('evidenceModal');
            const modalTitle = document.getElementById('modalTitle');
            const modalBody = document.getElementById('modalBody');

            modalTitle.textContent = `ğŸ“„ ${evidenceData.label} - ${evidenceData.insurer}`;

            let bodyHtml = `
                <div class="evidence-detail">
                    <label>ê°’</label>
                    <div class="value">${evidenceData.value}</div>
                </div>

                <div class="evidence-detail">
                    <label>ë¬¸ì„œ ì¶œì²˜</label>
                    <div class="value">${evidenceData.evidence}</div>
                </div>

                <div class="snippet">
                    [Snippet Placeholder]

                    ë¬¸ì„œ ì¢…ë¥˜ì— ë”°ë¥¸ ì‹¤ì œ ì›ë¬¸ ë°œì·Œê°€ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤.
                    í˜„ì¬ëŠ” í”„ë¡œí† íƒ€ì…ì´ë¯€ë¡œ placeholderë¡œ ëŒ€ì²´í•©ë‹ˆë‹¤.

                    ì‹¤ì œ êµ¬í˜„ ì‹œ:
                    - ì•½ê´€/ê°€ì…ì„¤ê³„ì„œ/ì‚¬ì—…ë°©ë²•ì„œ êµ¬ë¶„
                    - í˜ì´ì§€ ë²ˆí˜¸
                    - ì „í›„ ë§¥ë½ í¬í•¨ ë°œì·Œë¬¸
                </div>

                <button class="btn-primary" onclick="alert('ì›ë¬¸ ë³´ê¸°ëŠ” ì‹¤ì œ êµ¬í˜„ ì‹œ PDF ë·°ì–´ë¡œ ì—°ê²°ë©ë‹ˆë‹¤.')">
                    ì›ë¬¸ ë³´ê¸°
                </button>
            `;

            modalBody.innerHTML = bodyHtml;
            modal.classList.add('active');
        }

        function closeEvidenceModal() {
            const modal = document.getElementById('evidenceModal');
            modal.classList.remove('active');
        }

        // Close modal when clicking outside
        window.onclick = function(event) {
            const modal = document.getElementById('evidenceModal');
            if (event.target === modal) {
                closeEvidenceModal();
            }
        }

        // Load example 3 by default on page load
        window.addEventListener('DOMContentLoaded', () => {
            // Highlight example 3 button
            const buttons = document.querySelectorAll('.example-btn');
            if (buttons.length >= 3) {
                buttons[2].classList.add('active');
            }
            loadExample('example3_product_summary');
        });
    </script>
</body>
</html>
